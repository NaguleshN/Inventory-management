{% extends "base.html" %}

{% block base %}
<style>
#search{
  margin-top:100px;
}

</style>

{% comment %} search bar {% endcomment %}
 <div class="container  p-4 shadow-lg" id="search">
  <form action="{% url 'Home' %}" method="get">
<div class="input-group">
	<input type="text" name="query" value="{{query}}" class="form-control" placeholder="Search for...">
      <span class="input-group-btn">
        <button class="btn btn-search" type="button"><i class="fa fa-search fa-fw"></i> Search</button>
      </span>
</div>
</form>
</div> 


<br>
{% comment %} table {% endcomment %}

<div class="container mb-5">
<div class="card">
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-striped table-borderless">
                      <thead>
                        <tr>
                          <th>Product Name</th>
                          <th>Actual Quantity</th>
                          <th>Available Quantity</th>
                          <th>Category</th>
                          <th></th>
                          <th>Cart</th>
                        </tr>  
                      </thead>
                      <tbody>
                        {% for product in products %}
                        <tr>  
                          <td>{{product.name}}</td>
                          <td>{{ product.actual_count}}</td>
                          <td>{{ product.available_count}}</td>
                          <td>{{ product.category }}</td>
                          <td>
                          <a href="{% url 'Product_description' product.id %}" class="text-decoration-none text-black"><button class="btn btn-outline-primary">View Detail</button> </a></td>
                          </td> 
                          <td>
                            <form action="{% url 'add_to_cart' product.id %}" method="post">
                            {% csrf_token%}
                            <button class="btn btn-outline-primary" type="submit">ADD</button>
                            </form>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                   
                  </div>
                </div>
              </div> 
            </div>
            <!-- <script>
                document.addEventListener('DOMContentLoaded', () => {
                    // Fetch initial counts for products
                    document.querySelectorAll('.productCount').forEach(cell => {
                        const productId = cell.getAttribute('data-product-id');
                        fetch(`/get_product_count/${productId}`) // Replace with your Django URL to get the product count
                            .then(response => response.json())
                            .then(data => {
                                cell.textContent = data.count; // Update the count for the specific product
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    });
                
                    // Handle form submission and update count
                    document.querySelectorAll('form').forEach(form => {
                        form.addEventListener('submit', function(event) {
                            event.preventDefault(); // Prevent the default form submission
                
                            const productId = this.getAttribute('id').split('_')[1]; // Extract the product ID
                            const url = this.getAttribute('action');
                
                            fetch(url, { method: 'POST', body: new FormData(this) })
                                .then(response => response.json())
                                .then(data => {
                                    const countCell = document.querySelector(`.productCount[data-product-id="${productId}"]`);
                                    countCell.textContent = data.count; // Update the count for the specific product
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        });
                    });
                });
                </script>    -->
{% endblock %}